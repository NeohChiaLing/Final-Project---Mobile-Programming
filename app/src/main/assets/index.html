<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#8b5cf6"> <title>FitTrack</title>

    <script src="https://cdn.tailwindcss.com"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        brand: {
                            light: '#a78bfa',
                            DEFAULT: '#8b5cf6',
                            dark: '#7c3aed',
                        },
                        accent: {
                            blue: '#3b82f6',
                            cyan: '#06b6d4',
                            orange: '#f97316'
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');

        body { font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }

        /* Smooth Page Fade */
        .page { display: none; animation: fadeIn 0.3s ease-out; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Icon Pop Animation */
        .nav-icon-active { animation: pop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); color: #8b5cf6 !important; }
        @keyframes pop { 0% { transform: scale(1); } 50% { transform: scale(1.2); } 100% { transform: scale(1); } }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* Glassmorphism */
        .glass {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        /* TOAST NOTIFICATION ANIMATION */
        #toast {
            transition: transform 0.3s ease-in-out, opacity 0.3s;
            transform: translateY(-100%);
            opacity: 0;
        }
        #toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        /* Smooth Dark Mode Transition */
        html, body, div, section, nav {
            transition: background-color 0.3s ease, color 0.3s ease;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 dark:bg-gray-900 dark:text-white h-screen flex flex-col overflow-hidden">

<div id="editProfileModal" class="fixed inset-0 z-[60] hidden flex items-center justify-center bg-black/50 backdrop-blur-sm p-4">
    <div class="bg-white dark:bg-gray-800 w-full max-w-sm rounded-3xl p-6 shadow-2xl transform transition-all scale-100 border border-gray-100 dark:border-gray-700">
        <h3 class="text-xl font-bold mb-4 text-gray-800 dark:text-white">Edit Profile Details</h3>
        <form onsubmit="saveProfile(event)">
            <div class="space-y-4">
                <div>
                    <label class="block text-xs font-bold text-gray-400 uppercase mb-1">Name</label>
                    <input type="text" id="editName" class="w-full p-3 rounded-xl bg-gray-50 dark:bg-gray-700 border-none font-bold text-gray-800 dark:text-white focus:ring-2 focus:ring-brand outline-none">
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-xs font-bold text-gray-400 uppercase mb-1">Height (cm)</label>
                        <input type="number" id="editHeight" class="w-full p-3 rounded-xl bg-gray-50 dark:bg-gray-700 border-none font-bold text-gray-800 dark:text-white focus:ring-2 focus:ring-brand outline-none">
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-gray-400 uppercase mb-1">Weight (kg)</label>
                        <input type="number" id="editWeight" class="w-full p-3 rounded-xl bg-gray-50 dark:bg-gray-700 border-none font-bold text-gray-800 dark:text-white focus:ring-2 focus:ring-brand outline-none">
                    </div>
                </div>
            </div>
            <p class="text-xs text-gray-400 mt-4 text-center">To change photo, tap the picture on the main profile screen.</p>
            <div class="flex gap-3 mt-4">
                <button type="button" onclick="document.getElementById('editProfileModal').classList.add('hidden')" class="flex-1 p-3 rounded-xl font-bold text-gray-500 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition">Cancel</button>
                <button type="submit" class="flex-1 p-3 rounded-xl font-bold text-white bg-brand shadow-lg shadow-brand/30 active:scale-95 transition">Save</button>
            </div>
        </form>
    </div>
</div>

<div id="toast" class="fixed top-0 left-0 right-0 z-[100] p-4 flex justify-center pointer-events-none">
    <div id="toastCard" class="bg-white dark:bg-gray-800 dark:border-gray-700 rounded-2xl shadow-2xl border border-gray-100 p-4 flex items-center gap-4 min-w-[300px] pointer-events-auto">
        <div id="toastIcon" class="w-10 h-10 rounded-full bg-green-100 text-green-500 flex items-center justify-center text-xl">
            <i class="fa-solid fa-check"></i>
        </div>
        <div>
            <h4 id="toastTitle" class="font-bold text-gray-800 dark:text-white text-sm">Success</h4>
            <p id="toastMessage" class="text-xs text-gray-500 dark:text-gray-400 font-medium">Action completed successfully.</p>
        </div>
    </div>
</div>

<section id="home" class="page active flex-1 overflow-y-auto no-scrollbar pb-24 relative bg-gray-50 dark:bg-gray-900">

    <div class="relative bg-gradient-to-br from-brand-light via-brand to-brand-dark text-white p-6 pt-16 pb-16 rounded-b-[3rem] shadow-xl overflow-hidden">

        <div class="absolute top-0 right-0 -mt-12 -mr-12 w-48 h-48 bg-white opacity-10 rounded-full blur-3xl"></div>
        <div class="absolute bottom-0 left-0 -mb-12 -ml-6 w-32 h-32 bg-brand-light opacity-20 rounded-full blur-2xl"></div>

        <div class="relative z-10 flex justify-between items-start mb-8">
            <div>
                <p class="text-white/80 text-sm font-medium mb-1">Welcome back,</p>
                <h1 id="homeName" class="text-3xl font-extrabold tracking-tight">Loading...</h1>
            </div>
            <div onclick="nav('profile')" class="w-12 h-12 rounded-full p-0.5 bg-white/30 cursor-pointer hover:bg-white/50 transition duration-300 shadow-sm ring-2 ring-white/20">
                <img id="homeProfilePic" src="https://i.pravatar.cc/100?img=5" class="rounded-full w-full h-full object-cover border-2 border-white">
            </div>
        </div>

        <div class="glass rounded-2xl p-4 flex items-center justify-between relative z-10 mb-2">
            <div class="flex items-center gap-4">
                <div class="w-12 h-12 rounded-full bg-white/20 flex items-center justify-center">
                    <i class="fa-solid fa-shoe-prints text-2xl text-white"></i>
                </div>
                <div>
                    <p class="text-sm text-white/80 font-medium">Steps Today</p>
                    <h2 class="text-3xl font-bold text-white">5,432</h2>
                </div>
            </div>
            <div class="text-right">
                <p class="text-xs text-white/70 mb-1">Goal: 10k</p>
                <div class="w-16 h-1.5 bg-black/20 rounded-full overflow-hidden">
                    <div class="bg-white h-full w-[54%] rounded-full"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="p-5 space-y-5 relative z-20 -mt-8">

        <div class="grid grid-cols-2 gap-4">
            <div class="bg-white dark:bg-gray-800 dark:border-gray-700 p-4 rounded-2xl shadow-sm border border-gray-100 flex flex-col items-center text-center">
                <div class="w-10 h-10 rounded-full bg-orange-100 text-orange-500 flex items-center justify-center mb-2">
                    <i class="fa-solid fa-fire"></i>
                </div>
                <p class="text-2xl font-bold text-gray-800 dark:text-white">320</p>
                <p class="text-xs text-gray-500 dark:text-gray-400 font-medium uppercase tracking-wide">Calories</p>
            </div>
            <div class="bg-white dark:bg-gray-800 dark:border-gray-700 p-4 rounded-2xl shadow-sm border border-gray-100 flex flex-col items-center text-center">
                <div class="w-10 h-10 rounded-full bg-cyan-100 text-cyan-500 flex items-center justify-center mb-2">
                    <i class="fa-solid fa-droplet"></i>
                </div>
                <p class="text-2xl font-bold text-gray-800 dark:text-white">1.2L</p>
                <p class="text-xs text-gray-500 dark:text-gray-400 font-medium uppercase tracking-wide">Water</p>
            </div>
        </div>

        <div class="flex items-center justify-between bg-white dark:bg-gray-800 dark:border-gray-700 p-5 rounded-2xl shadow-sm border border-gray-100">
            <div class="flex items-center gap-4">
                <div id="weatherIconContainer" class="bg-yellow-50 text-yellow-500 w-12 h-12 rounded-2xl flex items-center justify-center shadow-sm">
                    <i id="weatherIcon" class="fa-solid fa-sun text-xl"></i>
                </div>
                <div>
                    <h3 id="weatherTemp" class="font-bold text-sm text-gray-800 dark:text-white">Loading...</h3>
                    <p id="weatherStatus" class="text-xs text-gray-500 dark:text-gray-400 font-medium mt-0.5">Checking weather...</p>
                </div>
            </div>
            <button onclick="loadWeather()" class="w-8 h-8 bg-gray-50 dark:bg-gray-700 rounded-full flex items-center justify-center text-gray-400 hover:text-brand hover:bg-brand/10 transition">
                <i class="fa-solid fa-rotate-right text-xs"></i>
            </button>
        </div>

        <div>
            <h3 class="font-bold text-lg mb-3 px-1 text-gray-800 dark:text-white">Quick Actions</h3>
            <div class="grid grid-cols-2 gap-3">
                <button onclick="nav('add')" class="bg-brand text-white p-4 rounded-2xl shadow-lg shadow-brand/30 flex items-center justify-between group active:scale-95 transition-all">
                    <span class="text-sm font-bold">Log Activity</span>
                    <div class="bg-white/20 w-8 h-8 rounded-full flex items-center justify-center group-hover:rotate-90 transition">
                        <i class="fa-solid fa-plus"></i>
                    </div>
                </button>
                <button onclick="nav('history')" class="bg-white dark:bg-gray-800 dark:border-gray-700 p-4 rounded-2xl shadow-sm border border-gray-100 flex items-center justify-between group active:scale-95 transition-all hover:border-brand/30">
                    <span class="text-sm font-bold text-gray-700 dark:text-gray-200">View History</span>
                    <div class="bg-gray-100 dark:bg-gray-700 text-gray-400 w-8 h-8 rounded-full flex items-center justify-center group-hover:text-brand transition">
                        <i class="fa-solid fa-arrow-right-long"></i>
                    </div>
                </button>
            </div>
        </div>
    </div>
</section>

<section id="add" class="page flex-1 overflow-y-auto no-scrollbar relative pb-24 bg-gray-50 dark:bg-gray-900">

    <div class="bg-gradient-to-br from-brand-light to-brand text-white p-6 pt-16 pb-10 rounded-b-[2.5rem] shadow-lg mb-6 relative overflow-hidden">
        <div class="absolute top-0 left-0 w-full h-full bg-white opacity-5 pattern-dots"></div>
        <div class="relative z-10 flex items-center">
            <h2 class="text-2xl font-extrabold">New Record</h2>
        </div>
    </div>

    <form id="addForm" onsubmit="saveActivity(event)" class="space-y-5 px-6">
        <input type="hidden" id="editId" value="">

        <div class="bg-white dark:bg-gray-800 dark:border-gray-700 p-2 rounded-2xl border border-gray-100 focus-within:border-brand/50 transition shadow-sm">
            <label class="text-xs font-bold text-gray-400 uppercase px-3">Date</label>
            <input type="date" id="dateInput" required class="w-full p-3 bg-transparent border-none focus:ring-0 font-medium text-gray-700 dark:text-white dark:invert-0">
        </div>

        <div>
            <label class="text-xs font-bold text-gray-400 uppercase px-2 mb-2 block">Activity Type</label>
            <input type="hidden" id="typeInput" value="Run">
            <div class="grid grid-cols-3 gap-3">
                <button type="button" onclick="selectType(this, 'Run')" class="type-btn p-4 rounded-2xl border-2 border-brand bg-brand/10 text-brand font-bold text-sm shadow-sm">Run</button>
                <button type="button" onclick="selectType(this, 'Yoga')" class="type-btn p-4 rounded-2xl border border-gray-200 bg-white dark:bg-gray-800 dark:border-gray-600 dark:text-gray-300 text-sm font-medium text-gray-600 hover:border-brand/50 transition">Yoga</button>
                <button type="button" onclick="selectType(this, 'Gym')" class="type-btn p-4 rounded-2xl border border-gray-200 bg-white dark:bg-gray-800 dark:border-gray-600 dark:text-gray-300 text-sm font-medium text-gray-600 hover:border-brand/50 transition">Gym</button>
            </div>
        </div>

        <div class="grid grid-cols-2 gap-4">
            <div class="bg-white dark:bg-gray-800 dark:border-gray-700 p-3 rounded-2xl border border-gray-100 shadow-sm">
                <label class="text-xs font-bold text-gray-400 uppercase block mb-1">Duration (min)</label>
                <input type="number" id="durationInput" required class="w-full bg-transparent border-none p-0 font-extrabold text-2xl text-gray-800 dark:text-white focus:ring-0" placeholder="0">
            </div>
            <div class="bg-white dark:bg-gray-800 dark:border-gray-700 p-3 rounded-2xl border border-gray-100 shadow-sm">
                <label class="text-xs font-bold text-gray-400 uppercase block mb-1">Calories</label>
                <input type="number" id="caloriesInput" required class="w-full bg-transparent border-none p-0 font-extrabold text-2xl text-gray-800 dark:text-white focus:ring-0" placeholder="0">
            </div>
        </div>

        <div class="bg-white dark:bg-gray-800 dark:border-gray-700 p-4 rounded-2xl border border-gray-100 shadow-sm">
            <label class="text-xs font-bold text-gray-400 uppercase mb-2 block">Water Intake (ml)</label>
            <div class="flex items-center gap-4">
                <i class="fa-solid fa-faucet-drip text-accent-cyan text-xl"></i>
                <input type="range" id="waterInput" class="w-full accent-accent-cyan h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer" min="0" max="2000" oninput="document.getElementById('waterDisplay').innerText = this.value + 'ml'">
                <span id="waterDisplay" class="text-xs font-bold text-gray-500 w-12">1000ml</span>
            </div>
        </div>

        <div><label class="text-xs font-bold text-gray-400 uppercase px-2 mb-2 block">Mood</label>
            <select id="moodInput" class="w-full p-4 bg-white dark:bg-gray-800 dark:border-gray-700 dark:text-white rounded-2xl border border-gray-100 font-medium text-gray-700 focus:ring-brand focus:border-brand shadow-sm">
                <option value="Happy">Happy üòä</option>
                <option value="Tired">Tired üò¥</option>
                <option value="Strong">Strong üí™</option>
                <option value="Neutral">Neutral üòê</option>
            </select>
        </div>

        <div><label class="text-xs font-bold text-gray-400 uppercase px-2 mb-2 block">Notes</label>
            <textarea id="notesInput" class="w-full p-4 bg-white dark:bg-gray-800 dark:border-gray-700 dark:text-white rounded-2xl border border-gray-100 font-medium text-gray-700 h-24 resize-none focus:ring-brand focus:border-brand shadow-sm" placeholder="Add details here..."></textarea>
        </div>

        <div class="grid grid-cols-2 gap-4 pt-2">
            <input type="file" id="photoInput" accept="image/*" capture="environment" style="display: none;" onchange="previewPhoto()">

            <button type="button" onclick="document.getElementById('photoInput').click()" class="p-4 border-2 border-dashed border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 rounded-2xl text-gray-400 font-bold text-sm hover:border-brand hover:text-brand hover:bg-brand/5 transition flex items-center justify-center gap-2">
                <i class="fa-solid fa-camera"></i> Photo
            </button>

            <button type="button" onclick="getGPS()" class="p-4 border-2 border-dashed border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 rounded-2xl text-gray-400 font-bold text-sm hover:border-brand hover:text-brand hover:bg-brand/5 transition flex items-center justify-center gap-2">
                <i class="fa-solid fa-location-dot"></i> GPS
            </button>
        </div>

        <div id="previewContainer" class="hidden relative mt-2">
            <img id="photoPreview" class="w-full h-48 object-cover rounded-2xl shadow-sm border border-gray-200">
            <button type="button" onclick="clearPhoto()" class="absolute top-2 right-2 bg-red-500 text-white w-8 h-8 rounded-full shadow-md flex items-center justify-center">
                <i class="fa-solid fa-xmark"></i>
            </button>
        </div>
        <button type="submit" class="w-full bg-brand text-white font-bold py-4 rounded-2xl shadow-xl shadow-brand/30 mt-6 active:scale-95 transition text-lg">Save Activity</button>
    </form>
</section>

<section id="history" class="page flex-1 overflow-y-auto no-scrollbar relative pb-24 bg-gray-50 dark:bg-gray-900">

    <div class="bg-gradient-to-br from-brand-light to-brand text-white p-6 pt-16 pb-8 rounded-b-[2.5rem] shadow-lg mb-4">
        <h2 class="text-2xl font-extrabold mb-4">History</h2>
        <div class="bg-white/20 backdrop-blur-md p-2 rounded-2xl border border-white/30 flex items-center gap-2 pl-4 focus-within:bg-white/30 transition">
            <i class="fa-solid fa-magnifying-glass text-white/70"></i>
            <input type="text" id="searchInput" oninput="searchHistory(this.value)" placeholder="Search activities..." class="bg-transparent w-full focus:outline-none text-sm font-medium text-white placeholder-white/60 py-2">
        </div>
    </div>

    <div class="space-y-4 px-6 mt-4" id="historyList">

        <p class="text-center text-gray-400 mt-10">Loading history...</p>

    </div>
</section>

<section id="details" class="page flex-1 overflow-y-auto no-scrollbar bg-white dark:bg-gray-800 relative pb-24">

    <div class="h-80 bg-gray-200 relative">
        <img id="latestImage" src="https://images.unsplash.com/photo-1530549387789-4c1017266635?auto=format&fit=crop&w=800&q=80" class="w-full h-full object-cover">
        <div class="absolute inset-0 bg-gradient-to-t from-black/90 via-black/20 to-transparent"></div>

        <button onclick="nav('history')" class="absolute top-12 left-6 w-10 h-10 bg-white/20 backdrop-blur-md border border-white/30 rounded-full text-white flex items-center justify-center z-50">
            <i class="fa-solid fa-arrow-left"></i>
        </button>

        <div class="absolute bottom-10 left-6 text-white z-20">
            <div id="latestTag" class="bg-brand text-white text-xs font-bold px-3 py-1.5 rounded-full inline-block mb-3 shadow-sm border border-white/20">--</div>
            <h1 id="latestTitle" class="text-4xl font-extrabold mb-2">--</h1>
            <p id="latestDate" class="text-sm opacity-90 font-medium flex items-center"><i class="fa-solid fa-calendar mr-2 text-brand-light"></i> --</p>
        </div>
    </div>

    <div class="p-6 bg-white dark:bg-gray-800 relative z-10 rounded-t-[2.5rem] -mt-8">

        <div class="flex justify-between mb-8 bg-gray-50 dark:bg-gray-700 p-4 rounded-2xl border border-gray-100 dark:border-gray-600 shadow-sm">
            <div class="text-center flex-1 border-r border-gray-200 dark:border-gray-500">
                <i class="fa-regular fa-clock text-brand mb-2 text-xl"></i>
                <p class="font-extrabold text-xl text-gray-800 dark:text-white leading-none"><span id="latestDuration">0</span><span class="text-sm font-medium text-gray-500 ml-1">m</span></p>
            </div>
            <div class="text-center flex-1 border-r border-gray-200 dark:border-gray-500">
                <i class="fa-solid fa-fire-flame-curved text-accent-orange mb-2 text-xl"></i>
                <p class="font-extrabold text-xl text-gray-800 dark:text-white leading-none" id="latestCalories">0</p>
            </div>
            <div class="text-center flex-1">
                <span class="text-3xl mb-1 block">üòÑ</span>
                <p class="font-bold text-sm text-gray-600 dark:text-gray-300" id="latestMood">Mood</p>
            </div>
        </div>

        <h3 class="font-bold text-lg mb-3 text-gray-800 dark:text-white px-1">Notes</h3>
        <div class="bg-gray-50 dark:bg-gray-700 p-5 rounded-2xl border border-gray-100 dark:border-gray-600 mb-8">
            <p id="latestNotes" class="text-gray-600 dark:text-gray-300 text-sm leading-relaxed font-medium">No notes available.</p>
        </div>

        <div class="flex gap-4">
            <button id="btnUpdateLatest" class="flex-1 bg-brand text-white font-bold py-4 rounded-2xl shadow-lg shadow-brand/20 flex items-center justify-center gap-2 active:scale-95 transition">
                <i class="fa-solid fa-pen-to-square"></i> Update Record
            </button>
            <button id="btnDeleteLatest" class="w-16 bg-red-50 text-red-500 border border-red-100 rounded-2xl flex items-center justify-center text-xl hover:bg-red-100 transition active:scale-95">
                <i class="fa-regular fa-trash-can"></i>
            </button>
        </div>
    </div>
</section>

<section id="profile" class="page flex-1 overflow-y-auto no-scrollbar relative pb-24 bg-gray-50 dark:bg-gray-900">

    <div class="bg-gradient-to-br from-brand-light to-brand text-white p-6 pt-16 pb-20 rounded-b-[3rem] shadow-lg relative mb-[-3rem]">
        <div class="flex justify-between items-center relative z-10">
            <h2 class="text-2xl font-extrabold">Profile</h2>
        </div>
    </div>

    <div class="px-6 relative z-10">
        <div class="bg-white dark:bg-gray-800 dark:border-gray-700 p-6 rounded-[2rem] shadow-lg border border-gray-100 flex flex-col items-center gap-3 text-center mb-8">
            <div class="relative -mt-16">
                <img id="profilePic" onclick="document.getElementById('profilePicInput').click()" src="https://i.pravatar.cc/100?img=5" class="w-24 h-24 rounded-full border-[6px] border-white shadow-md cursor-pointer">
                <input type="file" id="profilePicInput" accept="image/*" style="display: none;" onchange="updateProfilePic(event)">

                <div onclick="document.getElementById('editProfileModal').classList.remove('hidden')" class="absolute bottom-0 right-0 bg-brand text-white w-8 h-8 rounded-full flex items-center justify-center border-2 border-white text-xs shadow-sm cursor-pointer active:scale-90 transition-transform">
                    <i class="fa-solid fa-pen"></i>
                </div>
            </div>
            <div>
                <h3 id="profileName" class="text-2xl font-extrabold text-gray-800 dark:text-white">Loading...</h3>
            </div>
            <div class="flex gap-3 mt-2 text-sm font-bold text-gray-600 dark:text-gray-300 w-full justify-center">
                <div class="bg-gray-50 dark:bg-gray-700 px-4 py-2 rounded-xl border border-gray-100 dark:border-gray-600 min-w-[80px]"><span id="profileHeight">--</span> cm</div>
                <div class="bg-gray-50 dark:bg-gray-700 px-4 py-2 rounded-xl border border-gray-100 dark:border-gray-600 min-w-[80px]"><span id="profileWeight">--</span> kg</div>
            </div>
        </div>

        <div class="bg-white dark:bg-gray-800 dark:border-gray-700 border border-gray-100 p-5 rounded-[2rem] shadow-sm mb-6">
            <div class="flex items-center justify-between mb-6">
                <div>
                    <h3 class="font-bold text-lg text-gray-800 dark:text-white mb-1">Weekly Progress</h3>
                    <p class="text-xs font-medium text-gray-500">Calories Burned</p>
                </div>
            </div>
            <div class="relative h-56 w-full">
                <canvas id="fitnessChart"></canvas>
            </div>
        </div>

        <div class="space-y-3 pb-8">
            <button id="darkModeBtn" onclick="toggleDarkMode()" class="w-full bg-white dark:bg-gray-800 dark:border-gray-700 flex items-center justify-between p-4 rounded-2xl border border-gray-100 shadow-sm hover:border-brand/30 transition group">
                <div class="flex items-center gap-4">
                    <div class="w-10 h-10 rounded-xl bg-brand/10 text-brand flex items-center justify-center group-hover:scale-110 transition"><i class="fa-solid fa-moon"></i></div>
                    <span class="font-bold text-sm text-gray-700 dark:text-white">Dark Mode</span>
                </div>
                <div id="darkModeToggleBg" class="w-12 h-7 bg-gray-200 dark:bg-gray-600 rounded-full relative transition duration-300">
                    <div id="darkModeKnob" class="w-5 h-5 bg-white rounded-full shadow-sm absolute left-1 top-1 transition-all duration-300"></div>
                </div>
            </button>

            <button id="notifBtn" onclick="toggleNotifications()" class="w-full bg-white dark:bg-gray-800 dark:border-gray-700 flex items-center justify-between p-4 rounded-2xl border border-gray-100 shadow-sm hover:border-brand/30 transition group">
                <div class="flex items-center gap-4">
                    <div class="w-10 h-10 rounded-xl bg-accent-blue/10 text-accent-blue flex items-center justify-center group-hover:scale-110 transition"><i class="fa-solid fa-bell"></i></div>
                    <span class="font-bold text-sm text-gray-700 dark:text-white">Notifications</span>
                </div>
                <div id="notifToggleBg" class="w-12 h-7 bg-gray-200 dark:bg-gray-600 rounded-full relative transition duration-300">
                    <div id="notifKnob" class="w-5 h-5 bg-white rounded-full shadow-sm absolute left-1 top-1 transition-all duration-300"></div>
                </div>
            </button>
        </div>
    </div>
</section>

<nav class="fixed bottom-0 left-0 right-0 bg-white dark:bg-gray-800 dark:border-gray-700 border-t border-gray-100 px-4 py-2 flex justify-between items-end z-50 pb-6 shadow-[0_-5px_25px_rgba(0,0,0,0.03)]">

    <button onclick="nav('home')" class="nav-btn w-14 flex flex-col items-center gap-1.5 group transition-all rounded-2xl p-1" data-target="home">
        <i class="fa-solid fa-house text-xl text-gray-300 group-hover:text-brand transition-colors"></i>
        <span class="text-[10px] text-gray-400 font-semibold transition-colors">Home</span>
    </button>

    <button onclick="nav('history')" class="nav-btn w-14 flex flex-col items-center gap-1.5 group transition-all rounded-2xl p-1" data-target="history">
        <i class="fa-solid fa-list-check text-xl text-gray-300 group-hover:text-brand transition-colors"></i>
        <span class="text-[10px] text-gray-400 font-semibold transition-colors">History</span>
    </button>

    <div class="relative -top-8">
        <button onclick="nav('add')" class="bg-gradient-to-br from-brand-light to-brand text-white w-16 h-16 rounded-full flex items-center justify-center shadow-2xl shadow-brand/40 border-[5px] border-gray-50 active:scale-95 transition transform hover:rotate-90 hover:scale-105">
            <i class="fa-solid fa-plus text-2xl"></i>
        </button>
    </div>

    <button onclick="nav('details')" class="nav-btn w-14 flex flex-col items-center gap-1.5 group transition-all rounded-2xl p-1" data-target="details">
        <i class="fa-regular fa-file-lines text-xl text-gray-300 group-hover:text-brand transition-colors"></i>
        <span class="text-[10px] text-gray-400 font-semibold transition-colors">Latest</span>
    </button>

    <button onclick="nav('profile')" class="nav-btn w-14 flex flex-col items-center gap-1.5 group transition-all rounded-2xl p-1" data-target="profile">
        <i class="fa-regular fa-user text-xl text-gray-300 group-hover:text-brand transition-colors"></i>
        <span class="text-[10px] text-gray-400 font-semibold transition-colors">Profile</span>
    </button>
</nav>

<script>
    // --- 1. GLOBAL SETTINGS ---
    const BASE_URL = "http://192.168.0.10/fittrack_api";
    let newProfileImageBase64 = ""; // Variable to store new profile pic data

    document.addEventListener('DOMContentLoaded', () => {
        loadSettings();
        fetchProfile(); // Load backend profile data
    });

    // --- 2. TOAST NOTIFICATIONS ---
    function showToast(message, type = 'success') {
        const toast = document.getElementById('toast');
        const iconContainer = document.getElementById('toastIcon');
        const title = document.getElementById('toastTitle');
        const msg = document.getElementById('toastMessage');
        if (type === 'success') {
            iconContainer.className = "w-10 h-10 rounded-full bg-green-100 text-green-500 flex items-center justify-center text-xl";
            iconContainer.innerHTML = '<i class="fa-solid fa-check"></i>';
            title.innerText = "Success";
        } else {
            iconContainer.className = "w-10 h-10 rounded-full bg-red-100 text-red-500 flex items-center justify-center text-xl";
            iconContainer.innerHTML = '<i class="fa-solid fa-circle-exclamation"></i>';
            title.innerText = "Error";
        }
        msg.innerText = message;
        toast.classList.add('show');
        setTimeout(() => { toast.classList.remove('show'); }, 3000);
    }

    let currentActivities = [];

    // --- 3. NAVIGATION ---
    function nav(pageId) {
        document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
        document.getElementById(pageId).classList.add('active');
        if (pageId === 'home') loadWeather();
        if (pageId === 'history') loadHistory();
        if (pageId === 'details') loadLatest();
        document.querySelectorAll('.nav-btn').forEach(btn => {
            const icon = btn.querySelector('i');
            const text = btn.querySelector('span');
            if(icon) { icon.classList.remove('nav-icon-active', 'text-brand'); icon.classList.add('text-gray-300'); }
            if(text) { text.classList.remove('text-brand'); text.classList.add('text-gray-400'); }
            if(btn.dataset.target === pageId) {
                if(icon) { icon.classList.remove('text-gray-300'); icon.classList.add('nav-icon-active', 'text-brand'); }
                if(text) { text.classList.remove('text-gray-400'); text.classList.add('text-brand'); }
            }
        });
        window.scrollTo(0,0);
    }

    // --- 4. CHART ---
    const ctx = document.getElementById('fitnessChart').getContext('2d');
    let gradient = ctx.createLinearGradient(0, 0, 0, 400);
    gradient.addColorStop(0, 'rgba(139, 92, 246, 0.2)');
    gradient.addColorStop(1, 'rgba(255, 255, 255, 0)');
    new Chart(ctx, {
        type: 'line',
        data: {
            labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
            datasets: [{
                label: 'Calories',
                data: [150, 480, 200, 550, 320, 600, 400],
                borderColor: '#8b5cf6', borderWidth: 3, backgroundColor: gradient, fill: true, tension: 0.4,
                pointRadius: 4, pointBackgroundColor: '#ffffff', pointBorderColor: '#8b5cf6', pointBorderWidth: 2, pointHoverRadius: 6
            }]
        },
        options: {
            responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } },
            scales: { x: { grid: { display: false }, ticks: { font: { size: 10, weight: '500' }, color: '#9ca3af' } }, y: { display: false, min: 0 } },
            layout: { padding: { top: 10, bottom: 10, left: -10, right: -10 } }
        }
    });
    nav('home');

    function selectType(btn, type) {
        document.getElementById('typeInput').value = type;
        document.querySelectorAll('.type-btn').forEach(b => { b.className = "type-btn p-4 rounded-2xl border border-gray-200 bg-white dark:bg-gray-800 dark:border-gray-600 dark:text-gray-300 text-sm font-medium text-gray-600 transition"; });
        btn.className = "type-btn p-4 rounded-2xl border-2 border-brand bg-brand/10 text-brand font-bold text-sm shadow-sm";
    }

    // --- 5. SAVE ACTIVITY ---
    function saveActivity(event) {
        event.preventDefault();
        const editId = document.getElementById('editId').value;
        let API_URL = `${BASE_URL}/create_activity.php`;
        if (editId) { API_URL = `${BASE_URL}/update_activity.php`; }
        const activityData = {
            id: editId, date: document.getElementById('dateInput').value, type: document.getElementById('typeInput').value,
            duration: document.getElementById('durationInput').value, calories: document.getElementById('caloriesInput').value,
            water: document.getElementById('waterInput').value, mood: document.getElementById('moodInput').value,
            notes: document.getElementById('notesInput').value, image: currentImageBase64
        };
        const btn = document.querySelector("button[type='submit']");
        const originalText = btn.innerText; btn.innerText = "Saving..."; btn.disabled = true;
        fetch(API_URL, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(activityData) })
        .then(response => response.text())
        .then(text => {
            try {
                const data = JSON.parse(text);
                if(data.status === "success") {
                    showToast(editId ? "Record updated!" : "Activity saved!");
                    document.getElementById('addForm').reset(); clearPhoto(); document.getElementById('editId').value = "";
                    document.querySelector("button[type='submit']").innerText = "Save Activity"; nav('history');
                } else { showToast(data.message, 'error'); }
            } catch (e) { console.error("Server Error Raw:", text); alert("Server Error: " + text.substring(0, 300)); }
        })
        .catch(error => { console.error("Save Error:", error); showToast("Connection Failed", 'error'); })
        .finally(() => { btn.innerText = originalText; btn.disabled = false; });
    }

    // --- 6. LOAD HISTORY ---
    function loadHistory() {
        const GET_API_URL = `${BASE_URL}/get_activities.php`;
        const container = document.getElementById('historyList');
        container.innerHTML = '<p class="text-center text-gray-400 mt-10">Loading history...</p>';
        fetch(GET_API_URL).then(response => response.json()).then(data => {
            container.innerHTML = ''; let list = [];
            if (Array.isArray(data)) list = data; else if (data.status === "success" && Array.isArray(data.data)) list = data.data;
            if (list.length === 0) { container.innerHTML = '<p class="text-center text-gray-400 mt-10">No activities found.</p>'; } else {
                currentActivities = list;
                list.forEach(item => {
                    let iconClass = "fa-person-walking"; let colorClass = "bg-purple-100 text-purple-600";
                    if(item.activity_type === 'Run') { iconClass = "fa-person-running"; }
                    if(item.activity_type === 'Yoga') { iconClass = "fa-child-reaching"; colorClass = "bg-orange-100 text-orange-500"; }
                    if(item.activity_type === 'Gym') { iconClass = "fa-dumbbell"; colorClass = "bg-blue-100 text-blue-500"; }
                    let imageHtml = "";
                    if (item.image && item.image.length > 100) { imageHtml = `<img src="${item.image}" class="w-full h-32 object-cover rounded-xl mt-3 border border-gray-100">`; }
                    const card = `
                    <div class="bg-white dark:bg-gray-800 dark:border-gray-700 p-5 rounded-2xl shadow-sm border border-gray-100 flex flex-col mb-4 relative">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-4">
                                <div class="w-14 h-14 rounded-2xl ${colorClass} flex items-center justify-center text-2xl shadow-sm"><i class="fa-solid ${iconClass}"></i></div>
                                <div><h4 class="font-bold text-lg text-gray-800 dark:text-white mb-1">${item.activity_type}</h4><div class="flex items-center gap-2 text-xs text-gray-500 dark:text-gray-400 font-medium"><span>${item.activity_date}</span><span>‚Ä¢</span><span>${item.duration}m</span></div></div>
                            </div>
                            <div class="text-right"><span class="block font-extrabold text-brand text-lg">${item.calories}</span><span class="text-xs text-gray-400 font-medium uppercase">Kcal</span></div>
                        </div>
                        ${imageHtml}
                        <div class="flex justify-end gap-2 mt-3 pt-3 border-t border-gray-50 dark:border-gray-600">
                            <button onclick="startEdit(${item.id})" class="text-brand-light hover:text-brand text-sm px-3 py-1.5 border border-purple-50 rounded-lg bg-purple-50 dark:bg-gray-700 dark:border-gray-600"><i class="fa-solid fa-pen mr-1"></i> Edit</button>
                            <button onclick="deleteActivity(${item.id})" class="text-red-400 hover:text-red-600 text-sm px-3 py-1.5 border border-red-100 rounded-lg bg-red-50 dark:bg-gray-700 dark:border-gray-600"><i class="fa-regular fa-trash-can mr-1"></i> Delete</button>
                        </div>
                    </div>`;
                    container.innerHTML += card;
                });
            }
        }).catch(error => { console.error("Load History Error:", error); container.innerHTML = `<p class="text-red-500 text-center">Connection Failed</p>`; });
    }

    function loadLatest() {
        const GET_API_URL = `${BASE_URL}/get_activities.php`;
        fetch(GET_API_URL).then(response => response.json()).then(data => {
            let list = []; if (Array.isArray(data)) list = data; else if (data.status === "success" && Array.isArray(data.data)) list = data.data;
            if (list.length === 0) { document.getElementById('latestTitle').innerText = "No Data"; return; }
            const latest = list[0];
            document.getElementById('latestTitle').innerText = latest.activity_type; document.getElementById('latestTag').innerText = latest.activity_type;
            document.getElementById('latestDate').innerHTML = `<i class="fa-solid fa-calendar mr-2 text-brand-light"></i> ${latest.activity_date}`;
            document.getElementById('latestDuration').innerText = latest.duration; document.getElementById('latestCalories').innerText = latest.calories;
            document.getElementById('latestMood').innerText = latest.mood; document.getElementById('latestNotes').innerText = latest.notes || "No notes available.";
            const img = document.getElementById('latestImage');
            let defaultUrl = "https://images.unsplash.com/photo-1530549387789-4c1017266635";
            if (latest.activity_type === 'Run') defaultUrl = "https://images.unsplash.com/photo-1552674605-46d526703551";
            if (latest.activity_type === 'Yoga') defaultUrl = "https://images.unsplash.com/photo-1544367563-12123d8965cd";
            if (latest.activity_type === 'Gym') defaultUrl = "https://images.unsplash.com/photo-1534438327276-14e5300c3a48";
            img.onerror = function() { this.src = defaultUrl; this.onerror = null; };
            if (latest.image && latest.image.length > 200) { img.src = latest.image; } else { img.src = defaultUrl; }
            document.getElementById('btnUpdateLatest').onclick = function() { startEdit(latest.id); };
            document.getElementById('btnDeleteLatest').onclick = function() { deleteActivity(latest.id); };
        }).catch(error => console.error("Error loading latest:", error));
    }

    function deleteActivity(id) {
        if(!confirm("Delete this record?")) return;
        const DELETE_API_URL = `${BASE_URL}/delete_activity.php`;
        fetch(DELETE_API_URL, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ id: id }) })
        .then(response => response.json()).then(data => {
            if(data.status === "success") { showToast("Deleted successfully!"); loadHistory(); nav('history'); } else { showToast(data.message, 'error'); }
        }).catch(error => { showToast("Connection Failed", 'error'); });
    }

    function startEdit(id) {
        const item = currentActivities.find(a => a.id == id); if (!item) return;
        document.getElementById('editId').value = item.id; document.getElementById('dateInput').value = item.activity_date;
        document.getElementById('durationInput').value = item.duration; document.getElementById('caloriesInput').value = item.calories;
        document.getElementById('waterInput').value = item.water_intake; document.getElementById('moodInput').value = item.mood;
        document.getElementById('notesInput').value = item.notes;
        if(document.getElementById('waterDisplay')) { document.getElementById('waterDisplay').innerText = item.water_intake + 'ml'; }
        if (item.image && item.image.length > 100) { currentImageBase64 = item.image; document.getElementById('photoPreview').src = item.image; document.getElementById('previewContainer').classList.remove('hidden'); } else { clearPhoto(); }
        const buttons = document.querySelectorAll('.type-btn'); buttons.forEach(btn => { if(btn.innerText.trim() === item.activity_type) { selectType(btn, item.activity_type); } });
        document.querySelector("button[type='submit']").innerText = "Update Activity"; nav('add');
    }

    function searchHistory(query) {
        const lowerCaseQuery = query.toLowerCase();
        const filteredData = currentActivities.filter(item => {
            return (item.notes && item.notes.toLowerCase().includes(lowerCaseQuery)) ||
                   (item.activity_type && item.activity_type.toLowerCase().includes(lowerCaseQuery)) ||
                   (item.activity_date && item.activity_date.includes(lowerCaseQuery));
        });
        const container = document.getElementById('historyList'); container.innerHTML = '';
        if (filteredData.length === 0) { container.innerHTML = '<p class="text-center text-gray-400 mt-10">No matching results.</p>'; return; }
        filteredData.forEach(item => {
             let iconClass = "fa-person-walking"; let colorClass = "bg-purple-100 text-purple-600";
             if(item.activity_type === 'Run') { iconClass = "fa-person-running"; }
             if(item.activity_type === 'Yoga') { iconClass = "fa-child-reaching"; colorClass = "bg-orange-100 text-orange-500"; }
             if(item.activity_type === 'Gym') { iconClass = "fa-dumbbell"; colorClass = "bg-blue-100 text-blue-500"; }
             const card = `
             <div class="bg-white dark:bg-gray-800 dark:border-gray-700 p-5 rounded-2xl shadow-sm border border-gray-100 flex items-center justify-between mb-4 relative">
                 <div class="flex items-center gap-4">
                     <div class="w-14 h-14 rounded-2xl ${colorClass} flex items-center justify-center text-2xl shadow-sm"><i class="fa-solid ${iconClass}"></i></div>
                     <div><h4 class="font-bold text-lg text-gray-800 dark:text-white mb-1">${item.activity_type}</h4><div class="flex items-center gap-2 text-xs text-gray-500 dark:text-gray-400 font-medium"><span>${item.activity_date}</span><span>‚Ä¢</span><span>${item.duration}m</span></div></div>
                 </div>
                 <div class="flex flex-col items-end gap-2">
                     <span class="block font-extrabold text-brand text-lg text-right">${item.calories}</span>
                     <div class="flex gap-2">
                         <button onclick="startEdit(${item.id})" class="text-brand-light hover:text-brand text-sm px-2 py-1 border border-purple-100 rounded-lg bg-purple-50 dark:bg-gray-700 dark:border-gray-600"><i class="fa-solid fa-pen"></i></button>
                         <button onclick="deleteActivity(${item.id})" class="text-red-400 hover:text-red-600 text-sm px-2 py-1 border border-red-100 rounded-lg bg-red-50 dark:bg-gray-700 dark:border-gray-600"><i class="fa-regular fa-trash-can"></i></button>
                     </div>
                 </div>
             </div>`;
             container.innerHTML += card;
        });
    }

    function getGPS() {
        if ("geolocation" in navigator) {
            showToast("Requesting Location...", "success");
            const options = { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 };
            navigator.geolocation.getCurrentPosition(
                function(position) {
                    const lat = position.coords.latitude.toFixed(5); const long = position.coords.longitude.toFixed(5);
                    const notesField = document.getElementById('notesInput'); const timestamp = new Date().toLocaleTimeString(); const prefix = notesField.value ? "\n" : "";
                    notesField.value += `${prefix}üìç Location: ${lat}, ${long} (${timestamp})`; showToast("Location Added!");
                }, function(error) { showToast("GPS Error", "error"); }, options
            );
        } else { showToast("Geolocation is not supported.", "error"); }
    }

    function loadWeather() {
        const lat = 3.1390; const long = 101.6869; const API_URL = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${long}&current_weather=true`;
        fetch(API_URL).then(r => r.json()).then(data => {
            const temp = data.current_weather.temperature; const code = data.current_weather.weathercode;
            let status = "Sunny"; let icon = "fa-sun"; let color = "text-yellow-500"; let bg = "bg-yellow-50";
            if (code > 3) { status = "Cloudy"; icon = "fa-cloud"; color = "text-gray-500"; bg = "bg-gray-100"; }
            if (code > 50) { status = "Rainy"; icon = "fa-cloud-rain"; color = "text-blue-500"; bg = "bg-blue-100"; }
            if (code > 80) { status = "Storm"; icon = "fa-bolt"; color = "text-purple-500"; bg = "bg-purple-100"; }
            const tempElement = document.getElementById('weatherTemp'); const statusElement = document.getElementById('weatherStatus');
            const iconElement = document.getElementById('weatherIconContainer'); const iconI = document.getElementById('weatherIcon');
            if(tempElement) tempElement.innerText = temp + "¬∞C"; if(statusElement) statusElement.innerText = status + " ‚Ä¢ " + "Kuala Lumpur";
            if(iconElement) iconElement.className = `${bg} ${color} w-12 h-12 rounded-2xl flex items-center justify-center shadow-sm`;
            if(iconI) iconI.className = `fa-solid ${icon} text-xl`;
        }).catch(error => console.error("Weather Error:", error));
    }

    let currentImageBase64 = "";
    function previewPhoto() {
        const file = document.getElementById('photoInput').files[0];
        if (file) {
            const reader = new FileReader();
            reader.onloadend = function() {
                currentImageBase64 = reader.result;
                document.getElementById('photoPreview').src = currentImageBase64;
                document.getElementById('previewContainer').classList.remove('hidden');
                showToast("Photo selected!");
            }
            reader.readAsDataURL(file);
        }
    }

    function clearPhoto() { document.getElementById('photoInput').value = ""; currentImageBase64 = ""; document.getElementById('previewContainer').classList.add('hidden'); }

    // --- 10. PROFILE PICTURE UPDATE ---
    function updateProfilePic(event) {
        const file = event.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                // 1. Store the base64 data in the global variable
                newProfileImageBase64 = e.target.result;
                // 2. Update visually immediately
                document.getElementById('profilePic').src = newProfileImageBase64;
                showToast("Picture selected. Click Save in the modal.");
                 // 3. Open the modal so they can save it
                document.getElementById('editProfileModal').classList.remove('hidden');
            };
            reader.readAsDataURL(file);
        }
    }

    // --- 11. FETCH & SAVE PROFILE (BACKEND) ---
    function fetchProfile() {
        fetch(`${BASE_URL}/get_profile.php`)
        .then(response => response.json())
        .then(data => {
            if(data.status === "success") {
                const p = data.data;
                document.getElementById('homeName').innerText = p.name;
                document.getElementById('profileName').innerText = p.name;
                document.getElementById('profileHeight').innerText = p.height;
                document.getElementById('profileWeight').innerText = p.weight;
                document.getElementById('editName').value = p.name;
                document.getElementById('editHeight').value = p.height;
                document.getElementById('editWeight').value = p.weight;
                if(p.image) {
                    document.getElementById('profilePic').src = p.image;
                    document.getElementById('homeProfilePic').src = p.image;
                }
            }
        })
        .catch(e => console.error("Profile Fetch Error", e));
    }

    function saveProfile(event) {
        event.preventDefault();
        const name = document.getElementById('editName').value;
        const height = document.getElementById('editHeight').value;
        const weight = document.getElementById('editWeight').value;

        // Use existing image src if no new upload
        const data = { name: name, height: height, weight: weight };

        // ‚úÖ UPDATED: Check if a new image was selected and add it to data
        if(newProfileImageBase64) {
            data.image = newProfileImageBase64;
        }

        fetch(`${BASE_URL}/update_profile.php`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
        })
        .then(r => r.json())
        .then(d => {
            if(d.status === "success") {
                showToast("Profile Saved!");
                document.getElementById('editProfileModal').classList.add('hidden');
                // Clear the temporary image variable
                newProfileImageBase64 = "";
                fetchProfile(); // Refresh UI from backend
            } else {
                showToast("Error saving: " + d.message, "error");
            }
        })
        .catch(e => showToast("Connection error", "error"));
    }

    // =======================================================
    // --- 12. UI TOGGLES (Dark Mode & Notification) ---
    // =======================================================

    // A. Dark Mode
    function toggleDarkMode() {
        const html = document.documentElement;
        const knob = document.getElementById('darkModeKnob');
        const bg = document.getElementById('darkModeToggleBg');

        // Toggle the 'dark' class on HTML tag
        html.classList.toggle('dark');

        const isDark = html.classList.contains('dark');

        // Update UI
        updateToggleUI(knob, bg, isDark);

        // Save preference
        localStorage.setItem('darkMode', isDark);

        showToast(isDark ? "Dark Mode Enabled üåô" : "Light Mode Enabled ‚òÄÔ∏è");
    }

    // B. Notifications (UPDATED TO SIMULATION MODE)
    function toggleNotifications() {
        const knob = document.getElementById('notifKnob');
        const bg = document.getElementById('notifToggleBg');

        // Check current visual state (based on position)
        const isCurrentlyOn = knob.style.transform === 'translateX(20px)';

        if (!isCurrentlyOn) {
            // Turning ON (Simulated)
            updateToggleUI(knob, bg, true);
            localStorage.setItem('notifications', 'true');
            showToast("Notifications Enabled üîî");

            // Try actual notification if possible (bonus)
            if ("Notification" in window && Notification.permission !== "denied") {
                Notification.requestPermission();
            }
        } else {
            // Turning OFF
            updateToggleUI(knob, bg, false);
            localStorage.setItem('notifications', 'false');
            showToast("Notifications Disabled üîï");
        }
    }

    // Helper: Moves the knob and changes background color
    function updateToggleUI(knob, bg, isActive) {
        if (isActive) {
            knob.style.transform = "translateX(20px)";
            bg.className = "w-12 h-7 bg-brand rounded-full relative transition duration-300";
        } else {
            knob.style.transform = "translateX(0)";
            bg.className = "w-12 h-7 bg-gray-200 dark:bg-gray-600 rounded-full relative transition duration-300";
        }
    }

    // C. Load Settings on Startup
    function loadSettings() {
        // 1. Load Dark Mode
        const isDark = localStorage.getItem('darkMode') === 'true';
        if (isDark) {
            document.documentElement.classList.add('dark');
            updateToggleUI(
                document.getElementById('darkModeKnob'),
                document.getElementById('darkModeToggleBg'),
                true
            );
        }

        // 2. Load Notifications
        const notifActive = localStorage.getItem('notifications') === 'true';
        if (notifActive) {
            updateToggleUI(
                document.getElementById('notifKnob'),
                document.getElementById('notifToggleBg'),
                true
            );
        }
    }
</script>
</body>
</html>